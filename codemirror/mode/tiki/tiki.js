(function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)})((function(e){"use strict";e.defineMode("tiki",(function(e){function t(e,t,n){return function(i,o){while(!i.eol()){if(i.match(t)){o.tokenize=r;break}i.next()}return n&&(o.tokenize=n),e}}function n(e){return function(t,n){while(!t.eol())t.next();return n.tokenize=r,e}}function r(e,i){function o(t){return i.tokenize=t,t(e,i)}var u=e.sol(),a=e.next();switch(a){case"{":return e.eat("/"),e.eatSpace(),e.eatWhile(/[^\s\u00a0=\"\'\/?(}]/),i.tokenize=f,"tag";case"_":if(e.eat("_"))return o(t("strong","__",r));break;case"'":if(e.eat("'"))return o(t("em","''",r));break;case"(":if(e.eat("("))return o(t("variable-2","))",r));break;case"[":return o(t("variable-3","]",r));case"|":if(e.eat("|"))return o(t("comment","||"));break;case"-":if(e.eat("="))return o(t("header string","=-",r));if(e.eat("-"))return o(t("error tw-deleted","--",r));break;case"=":if(e.match("=="))return o(t("tw-underline","===",r));break;case":":if(e.eat(":"))return o(t("comment","::"));break;case"^":return o(t("tw-box","^"));case"~":if(e.match("np~"))return o(t("meta","~/np~"));break}if(u)switch(a){case"!":return e.match("!!!!!")||e.match("!!!!")||e.match("!!!")||e.match("!!"),o(n("header string"));case"*":case"#":case"+":return o(n("tw-listitem bracket"))}return null}var i,o,u,a,c=e.indentUnit;function f(e,t){var n=e.next(),i=e.peek();return"}"==n?(t.tokenize=r,"tag"):"("==n||")"==n?"bracket":"="==n?(o="equals",">"==i&&(e.next(),i=e.peek()),/[\'\"]/.test(i)||(t.tokenize=s()),"operator"):/[\'\"]/.test(n)?(t.tokenize=l(n),t.tokenize(e,t)):(e.eatWhile(/[^\s\u00a0=\"\'\/?]/),"keyword")}function l(e){return function(t,n){while(!t.eol())if(t.next()==e){n.tokenize=f;break}return"string"}}function s(){return function(e,t){while(!e.eol()){var n=e.next(),r=e.peek();if(" "==n||","==n||/[ )}]/.test(r)){t.tokenize=f;break}}return"string"}}function d(){for(var e=arguments.length-1;e>=0;e--)u.cc.push(arguments[e])}function k(){return d.apply(null,arguments),!0}function p(e,t){var n=u.context&&u.context.noIndent;u.context={prev:u.context,pluginName:e,indent:u.indented,startOfLine:t,noIndent:n}}function m(){u.context&&(u.context=u.context.prev)}function g(e){if("openPlugin"==e)return u.pluginName=i,k(h,x(u.startOfLine));if("closePlugin"==e){var t=!1;return u.context?(t=u.context.pluginName!=i,m()):t=!0,t&&(a="error"),k(b(t))}return"string"==e?(u.context&&"!cdata"==u.context.name||p("!cdata"),u.tokenize==r&&m(),k()):k()}function x(e){return function(t){return"selfclosePlugin"==t||"endPlugin"==t?k():"endPlugin"==t?(p(u.pluginName,e),k()):k()}}function b(e){return function(t){return e&&(a="error"),"endPlugin"==t?k():d()}}function h(e){return"keyword"==e?(a="attribute",k(h)):"equals"==e?k(v,h):d()}function v(e){return"keyword"==e?(a="string",k()):"string"==e?k(w):d()}function w(e){return"string"==e?k(w):d()}return{startState:function(){return{tokenize:r,cc:[],indented:0,startOfLine:!0,pluginName:null,context:null}},token:function(e,t){if(e.sol()&&(t.startOfLine=!0,t.indented=e.indentation()),e.eatSpace())return null;a=o=i=null;var n=t.tokenize(e,t);if((n||o)&&"comment"!=n){u=t;while(1){var r=t.cc.pop()||g;if(r(o||n))break}}return t.startOfLine=!1,a||n},indent:function(e,t){var n=e.context;if(n&&n.noIndent)return 0;n&&/^{\//.test(t)&&(n=n.prev);while(n&&!n.startOfLine)n=n.prev;return n?n.indent+c:0},electricChars:"/"}})),e.defineMIME("text/tiki","tiki")}));