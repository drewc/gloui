(function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)})((function(e){"use strict";e.defineMode("oz",(function(e){function t(e){return new RegExp("^(("+e.join(")|(")+"))\\b")}var n=/[\^@!\|<>#~\.\*\-\+\\/,=]/,r=/(<-)|(:=)|(=<)|(>=)|(<=)|(<:)|(>:)|(=:)|(\\=)|(\\=:)|(!!)|(==)|(::)/,i=/(:::)|(\.\.\.)|(=<:)|(>=:)/,o=["in","then","else","of","elseof","elsecase","elseif","catch","finally","with","require","prepare","import","export","define","do"],a=["end"],c=t(["true","false","nil","unit"]),u=t(["andthen","at","attr","declare","feat","from","lex","mod","div","mode","orelse","parser","prod","prop","scanner","self","syn","token"]),f=t(["local","proc","fun","case","class","if","cond","or","dis","choice","not","thread","try","raise","lock","for","suchthat","meth","functor"]),d=t(o),s=t(a);function l(e,t){if(e.eatSpace())return null;if(e.match(/[{}]/))return"bracket";if(e.match(/(\[])/))return"keyword";if(e.match(i)||e.match(r))return"operator";if(e.match(c))return"atom";var o=e.match(f);if(o)return t.doInCurrentLine?t.doInCurrentLine=!1:t.currentIndent++,"proc"==o[0]||"fun"==o[0]?t.tokenize=k:"class"==o[0]?t.tokenize=m:"meth"==o[0]&&(t.tokenize=h),"keyword";if(e.match(d)||e.match(u))return"keyword";if(e.match(s))return t.currentIndent--,"keyword";var a=e.next();if('"'==a||"'"==a)return t.tokenize=z(a),t.tokenize(e,t);if(/[~\d]/.test(a)){if("~"==a){if(!/^[0-9]/.test(e.peek()))return null;if("0"==e.next()&&e.match(/^[xX][0-9a-fA-F]+/)||e.match(/^[0-9]*(\.[0-9]+)?([eE][~+]?[0-9]+)?/))return"number"}return"0"==a&&e.match(/^[xX][0-9a-fA-F]+/)||e.match(/^[0-9]*(\.[0-9]+)?([eE][~+]?[0-9]+)?/)?"number":null}return"%"==a?(e.skipToEnd(),"comment"):"/"==a&&e.eat("*")?(t.tokenize=p,p(e,t)):n.test(a)?"operator":(e.eatWhile(/\w/),"variable")}function m(e,t){return e.eatSpace()?null:(e.match(/([A-Z][A-Za-z0-9_]*)|(`.+`)/),t.tokenize=l,"variable-3")}function h(e,t){return e.eatSpace()?null:(e.match(/([a-zA-Z][A-Za-z0-9_]*)|(`.+`)/),t.tokenize=l,"def")}function k(e,t){return e.eatSpace()?null:!t.hasPassedFirstStage&&e.eat("{")?(t.hasPassedFirstStage=!0,"bracket"):t.hasPassedFirstStage?(e.match(/([A-Z][A-Za-z0-9_]*)|(`.+`)|\$/),t.hasPassedFirstStage=!1,t.tokenize=l,"def"):(t.tokenize=l,null)}function p(e,t){var n,r=!1;while(n=e.next()){if("/"==n&&r){t.tokenize=l;break}r="*"==n}return"comment"}function z(e){return function(t,n){var r,i=!1,o=!1;while(null!=(r=t.next())){if(r==e&&!i){o=!0;break}i=!i&&"\\"==r}return!o&&i||(n.tokenize=l),"string"}}function b(){var e=o.concat(a);return new RegExp("[\\[\\]]|("+e.join("|")+")$")}return{startState:function(){return{tokenize:l,currentIndent:0,doInCurrentLine:!1,hasPassedFirstStage:!1}},token:function(e,t){return e.sol()&&(t.doInCurrentLine=0),t.tokenize(e,t)},indent:function(t,n){var r=n.replace(/^\s+|\s+$/g,"");return r.match(s)||r.match(d)||r.match(/(\[])/)?e.indentUnit*(t.currentIndent-1):t.currentIndent<0?0:t.currentIndent*e.indentUnit},fold:"indent",electricInput:b(),lineComment:"%",blockCommentStart:"/*",blockCommentEnd:"*/"}})),e.defineMIME("text/x-oz","oz")}));