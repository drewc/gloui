(function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror"),require("../python/python"),require("../stex/stex"),require("../../addon/mode/overlay")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../python/python","../stex/stex","../../addon/mode/overlay"],e):e(CodeMirror)})((function(e){"use strict";e.defineMode("rst",(function(t,a){var c=/^\*\*[^\*\s](?:[^\*]*[^\*\s])?\*\*/,n=/^\*[^\*\s](?:[^\*]*[^\*\s])?\*/,r=/^``[^`\s](?:[^`]*[^`\s])``/,m=/^(?:[\d]+(?:[\.,]\d+)*)/,o=/^(?:\s\+[\d]+(?:[\.,]\d+)*)/,s=/^(?:\s\-[\d]+(?:[\.,]\d+)*)/,i="[Hh][Tt][Tt][Pp][Ss]?://",h="(?:[\\d\\w.-]+)\\.(?:\\w{2,6})",l="(?:/[\\d\\w\\#\\%\\&\\-\\.\\,\\/\\:\\=\\?\\~]+)*",p=new RegExp("^"+i+h+l),d={token:function(e){if(e.match(c)&&e.match(/\W+|$/,!1))return"strong";if(e.match(n)&&e.match(/\W+|$/,!1))return"em";if(e.match(r)&&e.match(/\W+|$/,!1))return"string-2";if(e.match(m))return"number";if(e.match(o))return"positive";if(e.match(s))return"negative";if(e.match(p))return"link";while(null!=e.next()){if(e.match(c,!1))break;if(e.match(n,!1))break;if(e.match(r,!1))break;if(e.match(m,!1))break;if(e.match(o,!1))break;if(e.match(s,!1))break;if(e.match(p,!1))break}return null}},u=e.getMode(t,a.backdrop||"rst-base");return e.overlayMode(u,d,!0)}),"python","stex"),e.defineMode("rst-base",(function(t){function a(e){var t=Array.prototype.slice.call(arguments,1);return e.replace(/{(\d+)}/g,(function(e,a){return"undefined"!=typeof t[a]?t[a]:e}))}var c=e.getMode(t,"python"),n=e.getMode(t,"stex"),r="\\s+",m="(?:\\s*|\\W|$)",o=new RegExp(a("^{0}",m)),s="(?:[^\\W\\d_](?:[\\w!\"#$%&'()\\*\\+,\\-\\./:;<=>\\?]*[^\\W_])?)",i=new RegExp(a("^{0}",s)),h="(?:[^\\W\\d_](?:[\\w\\s!\"#$%&'()\\*\\+,\\-\\./:;<=>\\?]*[^\\W_])?)",l=a("(?:{0}|`{1}`)",s,h),p="(?:[^\\s\\|](?:[^\\|]*[^\\s\\|])?)",d="(?:[^\\`]+)",u=new RegExp(a("^{0}",d)),f=new RegExp("^([!'#$%&\"()*+,-./:;<=>?@\\[\\\\\\]^_`{|}~])\\1{3,}\\s*$"),k=new RegExp(a("^\\.\\.{0}",r)),x=new RegExp(a("^_{0}:{1}|^__:{1}",l,m)),b=new RegExp(a("^{0}::{1}",l,m)),w=new RegExp(a("^\\|{0}\\|{1}{2}::{3}",p,r,l,m)),g=new RegExp(a("^\\[(?:\\d+|#{0}?|\\*)]{1}",l,m)),E=new RegExp(a("^\\[{0}\\]{1}",l,m)),R=new RegExp(a("^\\|{0}\\|",p)),y=new RegExp(a("^\\[(?:\\d+|#{0}?|\\*)]_",l)),_=new RegExp(a("^\\[{0}\\]_",l)),v=new RegExp(a("^{0}__?",l)),$=new RegExp(a("^`{0}`_",d)),S=new RegExp(a("^:{0}:`{1}`{2}",s,d,m)),M=new RegExp(a("^`{1}`:{0}:{2}",s,d,m)),W=new RegExp(a("^:{0}:{1}",s,m)),q=new RegExp(a("^{0}",l)),T=new RegExp(a("^::{0}",m)),j=new RegExp(a("^\\|{0}\\|",p)),I=new RegExp(a("^{0}",r)),A=new RegExp(a("^{0}",l)),C=new RegExp(a("^::{0}",m)),H=new RegExp("^_"),P=new RegExp(a("^{0}|_",l)),z=new RegExp(a("^:{0}",m)),B=new RegExp("^::\\s*$"),D=new RegExp("^\\s+(?:>>>|In \\[\\d+\\]:)\\s");function F(t,a){var r=null;if(t.sol()&&t.match(D,!1))Q(a,N,{mode:c,local:e.startState(c)});else if(t.sol()&&t.match(k))Q(a,G),r="meta";else if(t.sol()&&t.match(f))Q(a,F),r="header";else if(V(a)==S||t.match(S,!1))switch(U(a)){case 0:Q(a,F,O(S,1)),t.match(/^:/),r="meta";break;case 1:Q(a,F,O(S,2)),t.match(i),r="keyword",t.current().match(/^(?:math|latex)/)&&(a.tmp_stex=!0);break;case 2:Q(a,F,O(S,3)),t.match(/^:`/),r="meta";break;case 3:if(a.tmp_stex&&(a.tmp_stex=void 0,a.tmp={mode:n,local:e.startState(n)}),a.tmp){if("`"==t.peek()){Q(a,F,O(S,4)),a.tmp=void 0;break}r=a.tmp.mode.token(t,a.tmp.local);break}Q(a,F,O(S,4)),t.match(u),r="string";break;case 4:Q(a,F,O(S,5)),t.match(/^`/),r="meta";break;case 5:Q(a,F,O(S,6)),t.match(o);break;default:Q(a,F)}else if(V(a)==M||t.match(M,!1))switch(U(a)){case 0:Q(a,F,O(M,1)),t.match(/^`/),r="meta";break;case 1:Q(a,F,O(M,2)),t.match(u),r="string";break;case 2:Q(a,F,O(M,3)),t.match(/^`:/),r="meta";break;case 3:Q(a,F,O(M,4)),t.match(i),r="keyword";break;case 4:Q(a,F,O(M,5)),t.match(/^:/),r="meta";break;case 5:Q(a,F,O(M,6)),t.match(o);break;default:Q(a,F)}else if(V(a)==W||t.match(W,!1))switch(U(a)){case 0:Q(a,F,O(W,1)),t.match(/^:/),r="meta";break;case 1:Q(a,F,O(W,2)),t.match(i),r="keyword";break;case 2:Q(a,F,O(W,3)),t.match(/^:/),r="meta";break;case 3:Q(a,F,O(W,4)),t.match(o);break;default:Q(a,F)}else if(V(a)==R||t.match(R,!1))switch(U(a)){case 0:Q(a,F,O(R,1)),t.match(j),r="variable-2";break;case 1:Q(a,F,O(R,2)),t.match(/^_?_?/)&&(r="link");break;default:Q(a,F)}else if(t.match(y))Q(a,F),r="quote";else if(t.match(_))Q(a,F),r="quote";else if(t.match(v))Q(a,F),t.peek()&&!t.peek().match(/^\W$/)||(r="link");else if(V(a)==$||t.match($,!1))switch(U(a)){case 0:!t.peek()||t.peek().match(/^\W$/)?Q(a,F,O($,1)):t.match($);break;case 1:Q(a,F,O($,2)),t.match(/^`/),r="link";break;case 2:Q(a,F,O($,3)),t.match(u);break;case 3:Q(a,F,O($,4)),t.match(/^`_/),r="link";break;default:Q(a,F)}else t.match(B)?Q(a,K):t.next()&&Q(a,F);return r}function G(t,a){var r=null;if(V(a)==w||t.match(w,!1))switch(U(a)){case 0:Q(a,G,O(w,1)),t.match(j),r="variable-2";break;case 1:Q(a,G,O(w,2)),t.match(I);break;case 2:Q(a,G,O(w,3)),t.match(A),r="keyword";break;case 3:Q(a,G,O(w,4)),t.match(C),r="meta";break;default:Q(a,F)}else if(V(a)==b||t.match(b,!1))switch(U(a)){case 0:Q(a,G,O(b,1)),t.match(q),r="keyword",t.current().match(/^(?:math|latex)/)?a.tmp_stex=!0:t.current().match(/^python/)&&(a.tmp_py=!0);break;case 1:Q(a,G,O(b,2)),t.match(T),r="meta",(t.match(/^latex\s*$/)||a.tmp_stex)&&(a.tmp_stex=void 0,Q(a,N,{mode:n,local:e.startState(n)}));break;case 2:Q(a,G,O(b,3)),(t.match(/^python\s*$/)||a.tmp_py)&&(a.tmp_py=void 0,Q(a,N,{mode:c,local:e.startState(c)}));break;default:Q(a,F)}else if(V(a)==x||t.match(x,!1))switch(U(a)){case 0:Q(a,G,O(x,1)),t.match(H),t.match(P),r="link";break;case 1:Q(a,G,O(x,2)),t.match(z),r="meta";break;default:Q(a,F)}else t.match(g)||t.match(E)?(Q(a,F),r="quote"):(t.eatSpace(),t.eol()?Q(a,F):(t.skipToEnd(),Q(a,J),r="comment"));return r}function J(e,t){return L(e,t,"comment")}function K(e,t){return L(e,t,"meta")}function L(e,t,a){return e.eol()||e.eatSpace()?(e.skipToEnd(),a):(Q(t,F),null)}function N(e,t){return t.ctx.mode&&t.ctx.local?e.sol()?(e.eatSpace()||Q(t,F),null):t.ctx.mode.token(e,t.ctx.local):(Q(t,F),null)}function O(e,t,a,c){return{phase:e,stage:t,mode:a,local:c}}function Q(e,t,a){e.tok=t,e.ctx=a||{}}function U(e){return e.ctx.stage||0}function V(e){return e.ctx.phase}return{startState:function(){return{tok:F,ctx:O(void 0,0)}},copyState:function(t){var a=t.ctx,c=t.tmp;return a.local&&(a={mode:a.mode,local:e.copyState(a.mode,a.local)}),c&&(c={mode:c.mode,local:e.copyState(c.mode,c.local)}),{tok:t.tok,ctx:a,tmp:c}},innerMode:function(e){return e.tmp?{state:e.tmp.local,mode:e.tmp.mode}:e.ctx.mode?{state:e.ctx.local,mode:e.ctx.mode}:null},token:function(e,t){return t.tok(e,t)}}}),"python","stex"),e.defineMIME("text/x-rst","rst")}));