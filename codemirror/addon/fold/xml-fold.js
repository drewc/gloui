(function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)})((function(e){"use strict";var n=e.Pos;function t(e,n){return e.line-n.line||e.ch-n.ch}var i="A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",r=i+"-:.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040",f=new RegExp("<(/?)(["+i+"]["+r+"]*)","g");function o(e,n,t,i){this.line=n,this.ch=t,this.cm=e,this.text=e.getLine(n),this.min=i?Math.max(i.from,e.firstLine()):e.firstLine(),this.max=i?Math.min(i.to-1,e.lastLine()):e.lastLine()}function u(e,t){var i=e.cm.getTokenTypeAt(n(e.line,t));return i&&/\btag\b/.test(i)}function l(e){if(!(e.line>=e.max))return e.ch=0,e.text=e.cm.getLine(++e.line),!0}function c(e){if(!(e.line<=e.min))return e.text=e.cm.getLine(--e.line),e.ch=e.text.length,!0}function a(e){for(;;){var n=e.text.indexOf(">",e.ch);if(-1==n){if(l(e))continue;return}if(u(e,n+1)){var t=e.text.lastIndexOf("/",n),i=t>-1&&!/\S/.test(e.text.slice(t+1,n));return e.ch=n+1,i?"selfClose":"regular"}e.ch=n+1}}function s(e){for(;;){var n=e.ch?e.text.lastIndexOf("<",e.ch-1):-1;if(-1==n){if(c(e))continue;return}if(u(e,n+1)){f.lastIndex=n,e.ch=n;var t=f.exec(e.text);if(t&&t.index==n)return t}else e.ch=n}}function h(e){for(;;){f.lastIndex=e.ch;var n=f.exec(e.text);if(!n){if(l(e))continue;return}if(u(e,n.index+1))return e.ch=n.index+n[0].length,n;e.ch=n.index+1}}function x(e){for(;;){var n=e.ch?e.text.lastIndexOf(">",e.ch-1):-1;if(-1==n){if(c(e))continue;return}if(u(e,n+1)){var t=e.text.lastIndexOf("/",n),i=t>-1&&!/\S/.test(e.text.slice(t+1,n));return e.ch=n+1,i?"selfClose":"regular"}e.ch=n}}function v(e,t){for(var i=[];;){var r,f=h(e),o=e.line,u=e.ch-(f?f[0].length:0);if(!f||!(r=a(e)))return;if("selfClose"!=r)if(f[1]){for(var l=i.length-1;l>=0;--l)if(i[l]==f[2]){i.length=l;break}if(l<0&&(!t||t==f[2]))return{tag:f[2],from:n(o,u),to:n(e.line,e.ch)}}else i.push(f[2])}}function g(e,t){for(var i=[];;){var r=x(e);if(!r)return;if("selfClose"!=r){var f=e.line,o=e.ch,u=s(e);if(!u)return;if(u[1])i.push(u[2]);else{for(var l=i.length-1;l>=0;--l)if(i[l]==u[2]){i.length=l;break}if(l<0&&(!t||t==u[2]))return{tag:u[2],from:n(e.line,e.ch),to:n(f,o)}}}else s(e)}}e.registerHelper("fold","xml",(function(e,i){for(var r=new o(e,i.line,0);;){var f=h(r);if(!f||r.line!=i.line)return;var u=a(r);if(!u)return;if(!f[1]&&"selfClose"!=u){var l=n(r.line,r.ch),c=v(r,f[2]);return c&&t(c.from,l)>0?{from:l,to:c.from}:null}}})),e.findMatchingTag=function(e,i,r){var f=new o(e,i.line,i.ch,r);if(-1!=f.text.indexOf(">")||-1!=f.text.indexOf("<")){var u=a(f),l=u&&n(f.line,f.ch),c=u&&s(f);if(u&&c&&!(t(f,i)>0)){var h={from:n(f.line,f.ch),to:l,tag:c[2]};return"selfClose"==u?{open:h,close:null,at:"open"}:c[1]?{open:g(f,c[2]),close:h,at:"close"}:(f=new o(e,l.line,l.ch,r),{open:h,close:v(f,c[2]),at:"open"})}}},e.findEnclosingTag=function(e,n,t,i){for(var r=new o(e,n.line,n.ch,t);;){var f=g(r,i);if(!f)break;var u=new o(e,n.line,n.ch,t),l=v(u,f.tag);if(l)return{open:f,close:l}}},e.scanForClosingTag=function(e,n,t,i){var r=new o(e,n.line,n.ch,i?{from:0,to:i}:null);return v(r,t)}}));