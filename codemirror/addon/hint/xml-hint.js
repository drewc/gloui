(function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],t):t(CodeMirror)})((function(t){"use strict";var e=t.Pos;function r(t,e,r){return r?t.indexOf(e)>=0:0==t.lastIndexOf(e,0)}function n(n,i){var s=i&&i.schemaInfo,a=i&&i.quoteChar||'"',o=i&&i.matchInMiddle;if(s){var l=n.getCursor(),f=n.getTokenAt(l);f.end>l.ch&&(f.end=l.ch,f.string=f.string.slice(0,l.ch-f.start));var g=t.innerMode(n.getMode(),f.state);if(g.mode.xmlCurrentTag){var c,h,u=[],d=!1,p=/\btag\b/.test(f.type)&&!/>$/.test(f.string),v=p&&/^\w/.test(f.string);if(v){var m=n.getLine(l.line).slice(Math.max(0,f.start-2),f.start),y=/<\/$/.test(m)?"close":/<$/.test(m)?"open":null;y&&(h=f.start-("close"==y?2:1))}else p&&"<"==f.string?y="open":p&&"</"==f.string&&(y="close");var x=g.mode.xmlCurrentTag(g.state);if(!p&&!x||y){v&&(c=f.string),d=y;var C=g.mode.xmlCurrentContext?g.mode.xmlCurrentContext(g.state):[],b=(g=C.length&&C[C.length-1],g&&s[g]),O=g?b&&b.children:s["!top"];if(O&&"close"!=y)for(var w=0;w<O.length;++w)c&&!r(O[w],c,o)||u.push("<"+O[w]);else if("close"!=y)for(var A in s)!s.hasOwnProperty(A)||"!top"==A||"!attrs"==A||c&&!r(A,c,o)||u.push("<"+A);g&&(!c||"close"==y&&r(g,c,o))&&u.push("</"+g+">")}else{b=x&&s[x.name];var M=b&&b.attrs,P=s["!attrs"];if(!M&&!P)return;if(M){if(P){var $={};for(var I in P)P.hasOwnProperty(I)&&($[I]=P[I]);for(var I in M)M.hasOwnProperty(I)&&($[I]=M[I]);M=$}}else M=P;if("string"==f.type||"="==f.string){m=n.getRange(e(l.line,Math.max(0,l.ch-60)),e(l.line,"string"==f.type?f.start:f.end));var T,j=m.match(/([^\s\u00a0=<>\"\']+)=$/);if(!j||!M.hasOwnProperty(j[1])||!(T=M[j[1]]))return;if("function"==typeof T&&(T=T.call(this,n)),"string"==f.type){c=f.string;var q=0;/['"]/.test(f.string.charAt(0))&&(a=f.string.charAt(0),c=f.string.slice(1),q++);var L=f.string.length;if(/['"]/.test(f.string.charAt(L-1))&&(a=f.string.charAt(L-1),c=f.string.substr(q,L-2)),q){var k=n.getLine(l.line);k.length>f.end&&k.charAt(f.end)==a&&f.end++}d=!0}var H=function(t){if(t)for(var e=0;e<t.length;++e)c&&!r(t[e],c,o)||u.push(a+t[e]+a);return z()};return T&&T.then?T.then(H):H(T)}for(var R in"attribute"==f.type&&(c=f.string,d=!0),M)!M.hasOwnProperty(R)||c&&!r(R,c,o)||u.push(R)}return z()}}function z(){return{list:u,from:d?e(l.line,null==h?f.start:h):l,to:d?e(l.line,f.end):l}}}t.registerHelper("hint","xml",n)}));