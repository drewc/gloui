(function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],t):t(CodeMirror)})((function(t){"use strict";var e,n,i=t.Pos;function r(t){var e=t.flags;return null!=e?e:(t.ignoreCase?"i":"")+(t.global?"g":"")+(t.multiline?"m":"")}function o(t,e){for(var n=r(t),i=n,o=0;o<e.length;o++)-1==i.indexOf(e.charAt(o))&&(i+=e.charAt(o));return n==i?t:new RegExp(t.source,i)}function l(t){return/\\s|\\n|\n|\\W|\\D|\[\^/.test(t.source)}function h(t,e,n){e=o(e,"g");for(var r=n.line,l=n.ch,h=t.lastLine();r<=h;r++,l=0){e.lastIndex=l;var s=t.getLine(r),c=e.exec(s);if(c)return{from:i(r,c.index),to:i(r,c.index+c[0].length),match:c}}}function s(t,e,n){if(!l(e))return h(t,e,n);e=o(e,"gm");for(var r,s=1,c=n.line,f=t.lastLine();c<=f;){for(var u=0;u<s;u++){if(c>f)break;var a=t.getLine(c++);r=null==r?a:r+"\n"+a}s*=2,e.lastIndex=n.ch;var g=e.exec(r);if(g){var m=r.slice(0,g.index).split("\n"),d=g[0].split("\n"),v=n.line+m.length-1,p=m[m.length-1].length;return{from:i(v,p),to:i(v+d.length-1,1==d.length?p+d[0].length:d[d.length-1].length),match:g}}}}function c(t,e,n){var i,r=0;while(r<=t.length){e.lastIndex=r;var o=e.exec(t);if(!o)break;var l=o.index+o[0].length;if(l>t.length-n)break;(!i||l>i.index+i[0].length)&&(i=o),r=o.index+1}return i}function f(t,e,n){e=o(e,"g");for(var r=n.line,l=n.ch,h=t.firstLine();r>=h;r--,l=-1){var s=t.getLine(r),f=c(s,e,l<0?0:s.length-l);if(f)return{from:i(r,f.index),to:i(r,f.index+f[0].length),match:f}}}function u(t,e,n){if(!l(e))return f(t,e,n);e=o(e,"gm");for(var r,h=1,s=t.getLine(n.line).length-n.ch,u=n.line,a=t.firstLine();u>=a;){for(var g=0;g<h&&u>=a;g++){var m=t.getLine(u--);r=null==r?m:m+"\n"+r}h*=2;var d=c(r,e,s);if(d){var v=r.slice(0,d.index).split("\n"),p=d[0].split("\n"),x=u+v.length,L=v[v.length-1].length;return{from:i(x,L),to:i(x+p.length-1,1==p.length?L+p[0].length:p[p.length-1].length),match:d}}}}function a(t,e,n,i){if(t.length==e.length)return n;for(var r=0,o=n+Math.max(0,t.length-e.length);;){if(r==o)return r;var l=r+o>>1,h=i(t.slice(0,l)).length;if(h==n)return l;h>n?o=l:r=l+1}}function g(t,r,o,l){if(!r.length)return null;var h=l?e:n,s=h(r).split(/\r|\n\r?/);t:for(var c=o.line,f=o.ch,u=t.lastLine()+1-s.length;c<=u;c++,f=0){var g=t.getLine(c).slice(f),m=h(g);if(1==s.length){var d=m.indexOf(s[0]);if(-1==d)continue t;o=a(g,m,d,h)+f;return{from:i(c,a(g,m,d,h)+f),to:i(c,a(g,m,d+s[0].length,h)+f)}}var v=m.length-s[0].length;if(m.slice(v)==s[0]){for(var p=1;p<s.length-1;p++)if(h(t.getLine(c+p))!=s[p])continue t;var x=t.getLine(c+s.length-1),L=h(x),b=s[s.length-1];if(L.slice(0,b.length)==b)return{from:i(c,a(g,m,v,h)+f),to:i(c+s.length-1,a(x,L,b.length,h))}}}}function m(t,r,o,l){if(!r.length)return null;var h=l?e:n,s=h(r).split(/\r|\n\r?/);t:for(var c=o.line,f=o.ch,u=t.firstLine()-1+s.length;c>=u;c--,f=-1){var g=t.getLine(c);f>-1&&(g=g.slice(0,f));var m=h(g);if(1==s.length){var d=m.lastIndexOf(s[0]);if(-1==d)continue t;return{from:i(c,a(g,m,d,h)),to:i(c,a(g,m,d+s[0].length,h))}}var v=s[s.length-1];if(m.slice(0,v.length)==v){var p=1;for(o=c-s.length+1;p<s.length-1;p++)if(h(t.getLine(o+p))!=s[p])continue t;var x=t.getLine(c+1-s.length),L=h(x);if(L.slice(L.length-s[0].length)==s[0])return{from:i(c+1-s.length,a(x,L,x.length-s[0].length,h)),to:i(c,a(g,m,v.length,h))}}}}function d(t,e,n,r){var l;this.atOccurrence=!1,this.doc=t,n=n?t.clipPos(n):i(0,0),this.pos={from:n,to:n},"object"==typeof r?l=r.caseFold:(l=r,r=null),"string"==typeof e?(null==l&&(l=!1),this.matches=function(n,i){return(n?m:g)(t,e,i,l)}):(e=o(e,"gm"),r&&!1===r.multiline?this.matches=function(n,i){return(n?f:h)(t,e,i)}:this.matches=function(n,i){return(n?u:s)(t,e,i)})}String.prototype.normalize?(e=function(t){return t.normalize("NFD").toLowerCase()},n=function(t){return t.normalize("NFD")}):(e=function(t){return t.toLowerCase()},n=function(t){return t}),d.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(e){var n=this.matches(e,this.doc.clipPos(e?this.pos.from:this.pos.to));while(n&&0==t.cmpPos(n.from,n.to))e?n.from.ch?n.from=i(n.from.line,n.from.ch-1):n=n.from.line==this.doc.firstLine()?null:this.matches(e,this.doc.clipPos(i(n.from.line-1))):n.to.ch<this.doc.getLine(n.to.line).length?n.to=i(n.to.line,n.to.ch+1):n=n.to.line==this.doc.lastLine()?null:this.matches(e,i(n.to.line+1,0));if(n)return this.pos=n,this.atOccurrence=!0,this.pos.match||!0;var r=i(e?this.doc.firstLine():this.doc.lastLine()+1,0);return this.pos={from:r,to:r},this.atOccurrence=!1},from:function(){if(this.atOccurrence)return this.pos.from},to:function(){if(this.atOccurrence)return this.pos.to},replace:function(e,n){if(this.atOccurrence){var r=t.splitLines(e);this.doc.replaceRange(r,this.pos.from,this.pos.to,n),this.pos.to=i(this.pos.from.line+r.length-1,r[r.length-1].length+(1==r.length?this.pos.from.ch:0))}}},t.defineExtension("getSearchCursor",(function(t,e,n){return new d(this.doc,t,e,n)})),t.defineDocExtension("getSearchCursor",(function(t,e,n){return new d(this,t,e,n)})),t.defineExtension("selectMatches",(function(e,n){var i=[],r=this.getSearchCursor(e,this.getCursor("from"),n);while(r.findNext()){if(t.cmpPos(r.to(),this.getCursor("to"))>0)break;i.push({anchor:r.from(),head:r.to()})}i.length&&this.setSelections(i,0)}))}));