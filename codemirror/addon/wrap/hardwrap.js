(function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],t):t(CodeMirror)})((function(t){"use strict";var e=t.Pos;function r(t,e,r){for(var n=r.paragraphStart||t.getHelper(e,"paragraphStart"),o=e.line,a=t.firstLine();o>a;--o){var i=t.getLine(o);if(n&&n.test(i))break;if(!/\S/.test(i)){++o;break}}for(var f=r.paragraphEnd||t.getHelper(e,"paragraphEnd"),l=e.line+1,h=t.lastLine();l<=h;++l){i=t.getLine(l);if(f&&f.test(i)){++l;break}if(!/\S/.test(i))break}return{from:o,to:l}}function n(t,e,r,n,o){var a=e;while(a<t.length&&" "==t.charAt(a))a++;for(;a>0;--a)if(r.test(t.slice(a-1,a+1)))break;if(!o&&a<=t.match(/^[ \t]*/)[0].length)for(a=e+1;a<t.length-1;++a)if(r.test(t.slice(a-1,a+1)))break;for(var i=!0;;i=!1){var f=a;if(n)while(" "==t.charAt(f-1))--f;if(0!=f||!i)return{from:f,to:a};a=e}}function o(r,o,a,i){o=r.clipPos(o),a=r.clipPos(a);var f=i.column||80,l=i.wrapOn||/\s\S|-[^\.\d]/,h=!1!==i.forceBreak,s=!1!==i.killTrailingSpace,c=[],g="",p=o.line,m=r.getRange(o,a,!1);if(!m.length)return null;var u=m[0].match(/^[ \t]*/)[0];u.length>=f&&(f=u.length+1);for(var v=0;v<m.length;++v){var d=m[v],b=g.length,k=0;g&&d&&!l.test(g.charAt(g.length-1)+d.charAt(0))&&(g+=" ",k=1);var w="";if(v&&(w=d.match(/^\s*/)[0],d=d.slice(w.length)),g+=d,v){var x=g.length>f&&u==w&&n(g,f,l,s,h);x&&x.from==b&&x.to==b+k?(g=u+d,++p):c.push({text:[k?" ":""],from:e(p,b),to:e(p+1,w.length)})}while(g.length>f){var S=n(g,f,l,s,h);if(!(S.from!=S.to||h&&u!==g.slice(0,S.to)))break;c.push({text:["",u],from:e(p,S.from),to:e(p,S.to)}),g=u+g.slice(S.to),++p}}return c.length&&r.operation((function(){for(var e=0;e<c.length;++e){var n=c[e];(n.text||t.cmpPos(n.from,n.to))&&r.replaceRange(n.text,n.from,n.to)}})),c.length?{from:c[0].from,to:t.changeEnd(c[c.length-1])}:null}t.defineExtension("wrapParagraph",(function(t,n){n=n||{},t||(t=this.getCursor());var a=r(this,t,n);return o(this,e(a.from,0),e(a.to-1),n)})),t.commands.wrapLines=function(t){t.operation((function(){for(var n=t.listSelections(),a=t.lastLine()+1,i=n.length-1;i>=0;i--){var f,l=n[i];if(l.empty()){var h=r(t,l.head,{});f={from:e(h.from,0),to:e(h.to-1)}}else f={from:l.from(),to:l.to()};f.to.line>=a||(a=f.from.line,o(t,f.from,f.to,{}))}}))},t.defineExtension("wrapRange",(function(t,e,r){return o(this,t,e,r||{})})),t.defineExtension("wrapParagraphsInRange",(function(t,n,a){a=a||{};for(var i=this,f=[],l=t.line;l<=n.line;){var h=r(i,e(l,0),a);f.push(h),l=h.to}var s=!1;return f.length&&i.operation((function(){for(var t=f.length-1;t>=0;--t)s=s||o(i,e(f[t].from,0),e(f[t].to-1),a)})),s}))}));