(function(t){"object"==typeof exports&&"object"==typeof module?t(require("../lib/codemirror")):"function"==typeof define&&define.amd?define(["../lib/codemirror"],t):t(CodeMirror)})((function(t){"use strict";var e=t.Pos;function n(t,e){return t.line==e.line&&t.ch==e.ch}var r=[];function o(t){r.push(t),r.length>50&&r.shift()}function i(t){if(!r.length)return o(t);r[r.length-1]+=t}function l(t){return r[r.length-(t?Math.min(t,1):1)]||""}function a(){return r.length>1&&r.pop(),l()}var c=null;function u(t,e,r,l,a){null==a&&(a=t.getRange(e,r)),"grow"==l&&c&&c.cm==t&&n(e,c.pos)&&t.isClean(c.gen)?i(a):!1!==l&&o(a),t.replaceRange("",e,r,"+delete"),c="grow"==l?{cm:t,pos:e,gen:t.changeGeneration()}:null}function f(t,e,n){return t.findPosH(e,n,"char",!0)}function s(t,e,n){return t.findPosH(e,n,"word",!0)}function g(t,e,n){return t.findPosV(e,n,"line",t.doc.sel.goalColumn)}function C(t,e,n){return t.findPosV(e,n,"page",t.doc.sel.goalColumn)}function d(t,n,r){for(var o=n.line,i=t.getLine(o),l=/\S/.test(r<0?i.slice(0,n.ch):i.slice(n.ch)),a=t.firstLine(),c=t.lastLine();;){if(o+=r,o<a||o>c)return t.clipPos(e(o-r,r<0?0:null));i=t.getLine(o);var u=/\S/.test(i);if(u)l=!0;else if(l)return e(o,0)}}function p(t,n,r){for(var o=n.line,i=n.ch,l=t.getLine(n.line),a=!1;;){var c=l.charAt(i+(r<0?-1:0));if(c){if(a&&/[!?.]/.test(c))return e(o,i+(r>0?1:0));a||(a=/\w/.test(c)),i+=r}else{if(o==(r<0?t.firstLine():t.lastLine()))return e(o,i);if(l=t.getLine(o+r),!/\S/.test(l))return e(o,i);o+=r,i=r<0?l.length:0}}}function h(t,r,o){var i;if(t.findMatchingBracket&&(i=t.findMatchingBracket(r,{strict:!0}))&&i.match&&(i.forward?1:-1)==o)return o>0?e(i.to.line,i.to.ch+1):i.to;for(var l=!0;;l=!1){var a=t.getTokenAt(r),c=e(r.line,o<0?a.start:a.end);if(!(l&&o>0&&a.end==r.ch)&&/\w/.test(a.string))return c;var u=t.findPosH(c,o,"char");if(n(c,u))return r;r=u}}function v(t,e){var n=t.state.emacsPrefix;return n?(y(t),"-"==n?-1:Number(n)):e?null:1}function A(t){var e="string"==typeof t?function(e){e.execCommand(t)}:t;return function(t){var n=v(t);e(t);for(var r=1;r<n;++r)e(t)}}function m(t,e,r,o){var i=v(t);i<0&&(o=-o,i=-i);for(var l=0;l<i;++l){var a=r(t,e,o);if(n(a,e))break;e=a}return e}function S(t,e){var n=function(n){n.extendSelection(m(n,n.getCursor(),t,e))};return n.motion=!0,n}function w(t,e,n,r){var o,i=t.listSelections(),l=i.length;while(l--)o=i[l].head,u(t,o,m(t,o,e,n),r)}function P(t,e){if(t.somethingSelected()){var n,r=t.listSelections(),o=r.length;while(o--)n=r[o],u(t,n.anchor,n.head,e);return!0}}function x(t,e){t.state.emacsPrefix?"-"!=e&&(t.state.emacsPrefix+=e):(t.state.emacsPrefix=e,t.on("keyHandled",R),t.on("inputRead",k))}var L={"Alt-G":!0,"Ctrl-X":!0,"Ctrl-Q":!0,"Ctrl-U":!0};function R(t,e){t.state.emacsPrefixMap||L.hasOwnProperty(e)||y(t)}function y(t){t.state.emacsPrefix=null,t.off("keyHandled",R),t.off("inputRead",k)}function k(t,e){var n=v(t);if(n>1&&"+input"==e.origin){for(var r=e.text.join("\n"),o="",i=1;i<n;++i)o+=r;t.replaceSelection(o)}}function b(t){t.state.emacsPrefixMap=!0,t.addKeyMap(K),t.on("keyHandled",U),t.on("inputRead",U)}function U(t,e){("string"!=typeof e||!/^\d$/.test(e)&&"Ctrl-U"!=e)&&(t.removeKeyMap(K),t.state.emacsPrefixMap=!1,t.off("keyHandled",U),t.off("inputRead",U))}function X(t){t.setCursor(t.getCursor()),t.setExtending(!t.getExtending()),t.on("change",(function(){t.setExtending(!1)}))}function D(t){t.setExtending(!1),t.setCursor(t.getCursor())}function E(t,e,n){t.openDialog?t.openDialog(e+': <input type="text" style="width: 10em"/>',n,{bottom:!0}):n(prompt(e,""))}function H(t,e){var n=t.getCursor(),r=t.findPosH(n,1,"word");t.replaceRange(e(t.getRange(n,r)),n,r),t.setCursor(r)}function M(t){var n=t.getCursor(),r=n.line,o=n.ch,i=[];while(r>=t.firstLine()){for(var l=t.getLine(r),a=null==o?l.length:o;a>0;){o=l.charAt(--a);if(")"==o)i.push("(");else if("]"==o)i.push("[");else if("}"==o)i.push("{");else if(/[\(\{\[]/.test(o)&&(!i.length||i.pop()!=o))return t.extendSelection(e(r,a))}--r,o=null}}function B(t){t.execCommand("clearSearch"),D(t)}t.emacs={kill:u,killRegion:P,repeated:A};var G=t.keyMap.emacs=t.normalizeKeyMap({"Ctrl-W":function(t){u(t,t.getCursor("start"),t.getCursor("end"),!0)},"Ctrl-K":A((function(t){var n=t.getCursor(),r=t.clipPos(e(n.line)),o=t.getRange(n,r);/\S/.test(o)||(o+="\n",r=e(n.line+1,0)),u(t,n,r,"grow",o)})),"Alt-W":function(t){o(t.getSelection()),D(t)},"Ctrl-Y":function(t){var e=t.getCursor();t.replaceRange(l(v(t)),e,e,"paste"),t.setSelection(e,t.getCursor())},"Alt-Y":function(t){t.replaceSelection(a(),"around","paste")},"Ctrl-Space":X,"Ctrl-Shift-2":X,"Ctrl-F":S(f,1),"Ctrl-B":S(f,-1),Right:S(f,1),Left:S(f,-1),"Ctrl-D":function(t){w(t,f,1,!1)},Delete:function(t){P(t,!1)||w(t,f,1,!1)},"Ctrl-H":function(t){w(t,f,-1,!1)},Backspace:function(t){P(t,!1)||w(t,f,-1,!1)},"Alt-F":S(s,1),"Alt-B":S(s,-1),"Alt-Right":S(s,1),"Alt-Left":S(s,-1),"Alt-D":function(t){w(t,s,1,"grow")},"Alt-Backspace":function(t){w(t,s,-1,"grow")},"Ctrl-N":S(g,1),"Ctrl-P":S(g,-1),Down:S(g,1),Up:S(g,-1),"Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd",End:"goLineEnd",Home:"goLineStart","Alt-V":S(C,-1),"Ctrl-V":S(C,1),PageUp:S(C,-1),PageDown:S(C,1),"Ctrl-Up":S(d,-1),"Ctrl-Down":S(d,1),"Alt-A":S(p,-1),"Alt-E":S(p,1),"Alt-K":function(t){w(t,p,1,"grow")},"Ctrl-Alt-K":function(t){w(t,h,1,"grow")},"Ctrl-Alt-Backspace":function(t){w(t,h,-1,"grow")},"Ctrl-Alt-F":S(h,1),"Ctrl-Alt-B":S(h,-1,"grow"),"Shift-Ctrl-Alt-2":function(t){var e=t.getCursor();t.setSelection(m(t,e,h,1),e)},"Ctrl-Alt-T":function(t){var e=h(t,t.getCursor(),-1),n=h(t,e,1),r=h(t,n,1),o=h(t,r,-1);t.replaceRange(t.getRange(o,r)+t.getRange(n,o)+t.getRange(e,n),e,r)},"Ctrl-Alt-U":A(M),"Alt-Space":function(t){var n=t.getCursor(),r=n.ch,o=n.ch,i=t.getLine(n.line);while(r&&/\s/.test(i.charAt(r-1)))--r;while(o<i.length&&/\s/.test(i.charAt(o)))++o;t.replaceRange(" ",e(n.line,r),e(n.line,o))},"Ctrl-O":A((function(t){t.replaceSelection("\n","start")})),"Ctrl-T":A((function(t){t.execCommand("transposeChars")})),"Alt-C":A((function(t){H(t,(function(t){var e=t.search(/\w/);return-1==e?t:t.slice(0,e)+t.charAt(e).toUpperCase()+t.slice(e+1).toLowerCase()}))})),"Alt-U":A((function(t){H(t,(function(t){return t.toUpperCase()}))})),"Alt-L":A((function(t){H(t,(function(t){return t.toLowerCase()}))})),"Alt-;":"toggleComment","Ctrl-/":A("undo"),"Shift-Ctrl--":A("undo"),"Ctrl-Z":A("undo"),"Cmd-Z":A("undo"),"Shift-Ctrl-Z":"redo","Shift-Alt-,":"goDocStart","Shift-Alt-.":"goDocEnd","Ctrl-S":"findPersistentNext","Ctrl-R":"findPersistentPrev","Ctrl-G":B,"Shift-Alt-5":"replace","Alt-/":"autocomplete",Enter:"newlineAndIndent","Ctrl-J":A((function(t){t.replaceSelection("\n","end")})),Tab:"indentAuto","Alt-G G":function(t){var e=v(t,!0);if(null!=e&&e>0)return t.setCursor(e-1);E(t,"Goto line",(function(e){var n;e&&!isNaN(n=Number(e))&&n==(0|n)&&n>0&&t.setCursor(n-1)}))},"Ctrl-X Tab":function(t){t.indentSelection(v(t,!0)||t.getOption("indentUnit"))},"Ctrl-X Ctrl-X":function(t){t.setSelection(t.getCursor("head"),t.getCursor("anchor"))},"Ctrl-X Ctrl-S":"save","Ctrl-X Ctrl-W":"save","Ctrl-X S":"saveAll","Ctrl-X F":"open","Ctrl-X U":A("undo"),"Ctrl-X K":"close","Ctrl-X Delete":function(t){u(t,t.getCursor(),p(t,t.getCursor(),1),"grow")},"Ctrl-X H":"selectAll","Ctrl-Q Tab":A("insertTab"),"Ctrl-U":b,fallthrough:"default"}),K={"Ctrl-G":y};function T(t){K[t]=function(e){x(e,t)},G["Ctrl-"+t]=function(e){x(e,t)},L["Ctrl-"+t]=!0}for(var N=0;N<10;++N)T(String(N));T("-")}));