(function(){function e(e,o,a){var r={},s=(e.length,[]);while(e){var t,i=e.match(/^(\w+)(\*?)(?:='([^\']*)'|<(~?)(\w+)(?:\/(\d+)-(\d+))?)\s*/),c=i[1],d=i[2];if(i[3])t=d?CodeMirror.Doc(i[3]):CodeMirror(o,n(a,{value:i[3]}));else{var l=i[5];r.hasOwnProperty(l)||(r[l]=s.length,s.push(CodeMirror(o,a)));var u=s[r[l]].linkedDoc({sharedHist:!i[4],from:i[6]?Number(i[6]):null,to:i[7]?Number(i[7]):null});t=d?u:CodeMirror(o,n(a,{value:u}))}r[c]=s.length,s.push(t),e=e.slice(i[0].length)}return s}function n(e,o){if(e){n.prototype=e;var a=new n;if(o)for(var r in o)o.hasOwnProperty(r)&&(a[r]=o[r]);return a}}function o(e){var n=arguments.length,o=null;if("string"==typeof arguments[n-1]&&(o=arguments[--n]),a==n)throw new Error("No editors provided to eqAll");for(var a=1;a<n;++a)eq(arguments[a].getValue(),e,o)}function a(n,o,a,r,s){return r||(r={}),test("doc_"+n,(function(){var n=document.getElementById("testground"),s=e(o,n,r),t=!1;try{a.apply(null,s),t=!0}finally{if(!t||verbose)n.style.visibility="visible";else for(var i=0;i<s.length;++i)s[i]instanceof CodeMirror&&n.removeChild(s[i].getWrapperElement())}}),s)}var r=/MSIE [1-7]\b/.test(navigator.userAgent);function s(e,n){o("x",e,n),e.setValue("hey"),o("hey",e,n),n.setValue("wow"),o("wow",e,n),e.replaceRange("u\nv\nw",Pos(0,3)),n.replaceRange("i",Pos(0,4)),n.replaceRange("j",Pos(2,1)),o("wowui\nv\nwj",e,n)}a("basic","A='x' B<A",s),a("basicSeparate","A='x' B<~A",s),a("sharedHist","A='ab\ncd\nef' B<A",(function(e,n){e.replaceRange("x",Pos(0)),n.replaceRange("y",Pos(1)),e.replaceRange("z",Pos(2)),o("abx\ncdy\nefz",e,n),e.undo(),e.undo(),o("abx\ncd\nef",e,n),e.redo(),o("abx\ncdy\nef",e,n),n.redo(),o("abx\ncdy\nefz",e,n),e.undo(),n.undo(),e.undo(),e.undo(),o("ab\ncd\nef",e,n)}),null,r),a("undoIntact","A='ab\ncd\nef' B<~A",(function(e,n){e.replaceRange("x",Pos(0)),n.replaceRange("y",Pos(1)),e.replaceRange("z",Pos(2)),e.replaceRange("q",Pos(0)),o("abxq\ncdy\nefz",e,n),e.undo(),e.undo(),o("abx\ncdy\nef",e,n),n.undo(),o("abx\ncd\nef",e,n),e.redo(),o("abx\ncd\nefz",e,n),e.redo(),o("abxq\ncd\nefz",e,n),e.undo(),e.undo(),e.undo(),e.undo(),o("ab\ncd\nef",e,n),n.redo(),o("ab\ncdy\nef",e,n)})),a("undoConflict","A='ab\ncd\nef' B<~A",(function(e,n){e.replaceRange("x",Pos(0)),e.replaceRange("z",Pos(2)),n.replaceRange("y",Pos(0)),e.undo(),e.undo(),o("abxy\ncd\nef",e,n),e.replaceRange("u",Pos(2)),e.replaceRange("v",Pos(0)),n.replaceRange("w",Pos(0)),e.undo(),e.undo(),o("abxyvw\ncd\nefu",e,n)})),a("doubleRebase","A='ab\ncd\nef\ng' B<~A C<B",(function(e,n,a){a.replaceRange("u",Pos(3)),e.replaceRange("",Pos(0,0),Pos(1,0)),a.undo(),o("cd\nef\ng",e,n,a)})),a("undoUpdate","A='ab\ncd\nef' B<~A",(function(e,n){e.replaceRange("x",Pos(2)),n.replaceRange("u\nv\nw\n",Pos(0,0)),e.undo(),o("u\nv\nw\nab\ncd\nef",e,n),e.redo(),o("u\nv\nw\nab\ncd\nefx",e,n),e.undo(),o("u\nv\nw\nab\ncd\nef",e,n),n.undo(),e.redo(),o("ab\ncd\nefx",e,n),e.undo(),o("ab\ncd\nef",e,n)})),a("undoKeepRanges","A='abcdefg' B<A",(function(e,n){var o=e.markText(Pos(0,1),Pos(0,3),{className:"foo"});n.replaceRange("x",Pos(0,0)),eqCharPos(o.find().from,Pos(0,2)),n.replaceRange("yzzy",Pos(0,1),Pos(0)),eq(o.find(),null),n.undo(),eqCharPos(o.find().from,Pos(0,2)),n.undo(),eqCharPos(o.find().from,Pos(0,1))})),a("longChain","A='uv' B<A C<B D<C",(function(e,n,a,r){e.replaceSelection("X"),o("Xuv",e,n,a,r),r.replaceRange("Y",Pos(0)),o("XuvY",e,n,a,r)})),a("broadCast","B<A C<A D<A E<A",(function(e,n,a,r,s){n.setValue("uu"),o("uu",e,n,a,r,s),e.replaceRange("v",Pos(0,1)),o("uvu",e,n,a,r,s)})),a("islands","A='x\ny\nz' B<A C<~A D<C",(function(e,n,a,r){e.replaceRange("u",Pos(0)),r.replaceRange("v",Pos(2)),n.undo(),o("x\ny\nzv",e,n,a,r),a.undo(),o("x\ny\nz",e,n,a,r),e.redo(),o("xu\ny\nz",e,n,a,r),r.redo(),o("xu\ny\nzv",e,n,a,r)})),a("unlink","B<A C<A D<B",(function(e,n,a,r){e.setValue("hi"),n.unlinkDoc(e),r.setValue("aye"),o("hi",e,a),o("aye",n,r),e.setValue("oo"),o("oo",e,a),o("aye",n,r)})),a("bareDoc","A*='foo' B*<A C<B",(function(e,n,a){is(e instanceof CodeMirror.Doc),is(n instanceof CodeMirror.Doc),is(a instanceof CodeMirror),o("foo",e,n,a),e.replaceRange("hey",Pos(0,0),Pos(0)),a.replaceRange("!",Pos(0)),o("hey!",e,n,a),n.unlinkDoc(e),n.setValue("x"),o("x",n,a),o("hey!",e)})),a("swapDoc","A='a' B*='b' C<A",(function(e,n,a){var r=e.swapDoc(n);r.setValue("x"),o("x",a,r),o("b",e,n)})),a("docKeepsScroll","A='x' B*='y'",(function(e,n){addDoc(e,200,200),e.scrollIntoView(Pos(199,200));var o=e.swapDoc(n);e.swapDoc(o);var a=e.getScrollInfo();is(a.left>0,"not at left"),is(a.top>0,"not at top")})),a("copyDoc","A='u'",(function(e){var n=e.getDoc().copy(!0);e.setValue("foo"),n.setValue("bar");var o=e.swapDoc(n);eq(e.getValue(),"bar"),e.undo(),eq(e.getValue(),"u"),e.swapDoc(o),eq(e.getValue(),"foo"),eq(o.historySize().undo,1),eq(o.copy(!1).historySize().undo,0)})),a("docKeepsMode","A='1+1'",(function(e){var n=CodeMirror.Doc("hi","text/x-markdown");e.setOption("mode","text/javascript");var o=e.swapDoc(n);eq(e.getOption("mode"),"text/x-markdown"),eq(e.getMode().name,"markdown"),e.swapDoc(o),eq(e.getOption("mode"),"text/javascript"),eq(e.getMode().name,"javascript")})),a("subview","A='1\n2\n3\n4\n5' B<~A/1-3",(function(e,n){eq(n.getValue(),"2\n3"),eq(n.firstLine(),1),n.setCursor(Pos(4)),eqCharPos(n.getCursor(),Pos(2,1)),e.replaceRange("-1\n0\n",Pos(0,0)),eq(n.firstLine(),3),eqCharPos(n.getCursor(),Pos(4,1)),e.undo(),eqCharPos(n.getCursor(),Pos(2,1)),n.replaceRange("oyoy\n",Pos(2,0)),eq(e.getValue(),"1\n2\noyoy\n3\n4\n5"),n.undo(),eq(e.getValue(),"1\n2\n3\n4\n5")})),a("subviewEditOnBoundary","A='11\n22\n33\n44\n55' B<~A/1-4",(function(e,n){e.replaceRange("x\nyy\nz",Pos(0,1),Pos(2,1)),eq(n.firstLine(),2),eq(n.lineCount(),2),eq(n.getValue(),"z3\n44"),e.replaceRange("q\nrr\ns",Pos(3,1),Pos(4,1)),eq(n.firstLine(),2),eq(n.getValue(),"z3\n4q"),eq(e.getValue(),"1x\nyy\nz3\n4q\nrr\ns5"),e.execCommand("selectAll"),e.replaceSelection("!"),o("!",e,n)})),a("sharedMarker","A='ab\ncd\nef\ngh' B<A C<~A/1-2",(function(e,n,o){var a=n.markText(Pos(0,1),Pos(3,1),{className:"cm-searching",shared:!0}),r=e.findMarksAt(Pos(0,2));eq(r.length,1),eq(r[0],a),eq(o.findMarksAt(Pos(1,1)).length,1),eqCharPos(a.find().from,Pos(0,1)),eqCharPos(a.find().to,Pos(3,1)),n.replaceRange("x\ny\n",Pos(0,0)),eqCharPos(a.find().from,Pos(2,1)),eqCharPos(a.find().to,Pos(5,1));var s=0;CodeMirror.on(a,"clear",(function(){++s})),n.operation((function(){a.clear()})),eq(e.findMarksAt(Pos(3,1)).length,0),eq(n.findMarksAt(Pos(3,1)).length,0),eq(o.findMarksAt(Pos(3,1)).length,0),eq(a.find(),null),eq(s,1)})),a("sharedMarkerCopy","A='abcde'",(function(e){var n=e.markText(Pos(0,1),Pos(0,3),{shared:!0}),o=e.linkedDoc(),a=o.findMarksAt(Pos(0,2));eq(a.length,1),eq(a[0],n),n.clear(),eq(o.findMarksAt(Pos(0,2)),0)})),a("sharedMarkerDetach","A='abcde' B<A C<B",(function(e,n,o){var a=e.markText(Pos(0,1),Pos(0,3),{shared:!0});e.unlinkDoc(n);var r=n.findMarksAt(Pos(0,2));eq(r.length,1),is(r[0]!=a);var s=o.findMarksAt(Pos(0,2));eq(s.length,1),is(s[0]!=a),s[0].clear(),is(a.find())})),a("sharedBookmark","A='ab\ncd\nef\ngh' B<A C<~A/1-2",(function(e,n,o){var a=n.setBookmark(Pos(1,1),{shared:!0}),r=e.findMarksAt(Pos(1,1));eq(r.length,1),eq(r[0],a),eq(o.findMarksAt(Pos(1,1)).length,1),eqCharPos(a.find(),Pos(1,1)),n.replaceRange("x\ny\n",Pos(0,0)),eqCharPos(a.find(),Pos(3,1));var s=0;CodeMirror.on(a,"clear",(function(){++s})),n.operation((function(){a.clear()})),eq(e.findMarks(Pos(0,0),Pos(5)).length,0),eq(n.findMarks(Pos(0,0),Pos(5)).length,0),eq(o.findMarks(Pos(0,0),Pos(5)).length,0),eq(a.find(),null),eq(s,1)})),a("undoInSubview","A='line 0\nline 1\nline 2\nline 3\nline 4' B<A/1-4",(function(e,n){n.replaceRange("x",Pos(2,0)),e.undo(),eq(e.getValue(),"line 0\nline 1\nline 2\nline 3\nline 4"),eq(n.getValue(),"line 1\nline 2\nline 3")}))})();