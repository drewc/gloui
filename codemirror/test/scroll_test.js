(function(){"use strict";function e(e){return byClassName(e.getWrapperElement(),"CodeMirror-hscrollbar")[0]}function t(e){return byClassName(e.getWrapperElement(),"CodeMirror-vscrollbar")[0]}function o(t,o){return o&&t.display.scroller.offsetHeight>t.display.scroller.clientHeight?e(t).getBoundingClientRect().top:t.getWrapperElement().getBoundingClientRect().bottom-1}function n(e,o){return o&&e.display.scroller.offsetWidth>e.display.scroller.clientWidth?t(e).getBoundingClientRect().left:e.getWrapperElement().getBoundingClientRect().right-1}function r(e,t){e.setSize("100px","100px"),t&&e.setValue(new Array(100).join("x"));for(var n=o(e,t),r=0;r<30;r++){e.replaceSelection("x\n");var i=e.cursorCoords(null,"window").bottom;is(i<=n)}is(i>=n-5)}function i(e,t){e.getWrapperElement().style.height="auto",t&&e.setValue(new Array(100).join("x")),e.refresh();for(var n=0;n<30;n++){e.replaceSelection("x\n");var r=o(e,t),i=e.cursorCoords(null,"window").bottom;is(i<=r),is(i>=r-5)}}function l(e,t,o){e.setSize("100px","100px"),t&&e.setOption("lineWrapping",!0),o&&(e.setValue("\n"+new Array(100).join("x\n")),e.setCursor(Pos(0,0)));for(var r=n(e,o),i=0;i<10;i++){e.replaceSelection("xxxxxxxxxx");var l=e.cursorCoords(null,"window").right;is(l<r)}t||is(l>r-20)}namespace="scroll_",testCM("bars_hidden",(function(e){for(var t=0;;t++){var o=e.getWrapperElement().getBoundingClientRect(),n=e.getScrollerElement().getBoundingClientRect();if(is(o.bottom<n.bottom-10),is(o.right<n.right-10),1==t)break;e.getWrapperElement().style.height="auto",e.refresh()}})),testCM("movedown_fixed",(function(e){r(e,!1)})),testCM("movedown_hscroll_fixed",(function(e){r(e,!0)})),testCM("movedown_resize",(function(e){i(e,!1)})),testCM("movedown_hscroll_resize",(function(e){i(e,!0)})),testCM("moveright",(function(e){l(e,!1,!1)})),testCM("moveright_wrap",(function(e){l(e,!0,!1)})),testCM("moveright_scroll",(function(e){l(e,!1,!0)})),testCM("moveright_scroll_wrap",(function(e){l(e,!0,!0)})),testCM("suddenly_wide",(function(t){addDoc(t,100,100),t.replaceSelection(new Array(600).join("l ")+"\n"),t.execCommand("goLineUp"),t.execCommand("goLineEnd"),is(e(t).scrollLeft>t.getScrollerElement().scrollLeft-1)})),testCM("wrap_changes_height",(function(e){var t=new Array(20).join("a ")+"\n";e.setValue(new Array(20).join(t));var n=e.getWrapperElement().getBoundingClientRect();e.setSize(e.cursorCoords(Pos(0),"window").right-n.left+2,e.cursorCoords(Pos(19,0),"window").bottom-n.top+2),e.setCursor(Pos(19,0)),e.replaceSelection("\n"),is(e.cursorCoords(null,"window").bottom<o(e,!1))}),{lineWrapping:!0}),testCM("height_auto_with_gutter_expect_no_scroll_after_line_delete",(function(e){e.setSize(null,"auto"),e.setValue("x\n"),e.execCommand("goDocEnd"),e.execCommand("delCharBefore"),eq(e.getScrollInfo().top,0),e.scrollTo(null,10),is(e.getScrollInfo().top<5)}),{lineNumbers:!0}),testCM("bidi_ensureCursorVisible",(function(e){e.setValue("<dd>وضع الاستخدام. عندما لا تعطى، وهذا الافتراضي إلى الطريقة الاولى\n"),e.execCommand("goLineStart"),eq(e.getScrollInfo().left,0),e.execCommand("goCharRight"),e.execCommand("goCharRight"),e.execCommand("goCharRight"),eqCursorPos(e.getCursor(),Pos(0,3,"before")),eq(e.getScrollInfo().left,0)}),{lineWrapping:!1})})();