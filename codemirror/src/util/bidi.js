import{lst}from"./misc.js";export function iterateBidiSections(r,t,L,e){if(!r)return e(t,L,"ltr",0);let l=!1;for(let n=0;n<r.length;++n){let m=r[n];(m.from<L&&m.to>t||t==L&&m.to==t)&&(e(Math.max(m.from,t),Math.min(m.to,L),1==m.level?"rtl":"ltr",n),l=!0)}l||e(t,L,"ltr")}export let bidiOther=null;export function getBidiPartAt(r,t,L){let e;bidiOther=null;for(let l=0;l<r.length;++l){let n=r[l];if(n.from<t&&n.to>t)return l;n.to==t&&(n.from!=n.to&&"before"==L?e=l:bidiOther=l),n.from==t&&(n.from!=n.to&&"before"!=L?e=l:bidiOther=l)}return null!=e?e:bidiOther}let bidiOrdering=function(){let r="bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN",t="nnnnnnNNr%%r,rNNmmmmmmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmmmnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmnNmmmmmmrrmmNmmmmrr1111111111";function L(L){return L<=247?r.charAt(L):1424<=L&&L<=1524?"R":1536<=L&&L<=1785?t.charAt(L-1536):1774<=L&&L<=2220?"r":8192<=L&&L<=8203?"w":8204==L?"b":"L"}let e=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,l=/[stwN]/,n=/[LRr]/,m=/[Lb1n]/,b=/[1n]/;function N(r,t,L){this.level=r,this.from=t,this.to=L}return function(r,t){let o="ltr"==t?"L":"R";if(0==r.length||"ltr"==t&&!e.test(r))return!1;let f=r.length,i=[];for(let e=0;e<f;++e)i.push(L(r.charCodeAt(e)));for(let L=0,e=o;L<f;++L){let r=i[L];"m"==r?i[L]=e:e=r}for(let L=0,e=o;L<f;++L){let r=i[L];"1"==r&&"r"==e?i[L]="n":n.test(r)&&(e=r,"r"==r&&(i[L]="R"))}for(let L=1,e=i[0];L<f-1;++L){let r=i[L];"+"==r&&"1"==e&&"1"==i[L+1]?i[L]="1":","!=r||e!=i[L+1]||"1"!=e&&"n"!=e||(i[L]=e),e=r}for(let L=0;L<f;++L){let r=i[L];if(","==r)i[L]="N";else if("%"==r){let r;for(r=L+1;r<f&&"%"==i[r];++r);let t=L&&"!"==i[L-1]||r<f&&"1"==i[r]?"1":"N";for(let e=L;e<r;++e)i[e]=t;L=r-1}}for(let L=0,e=o;L<f;++L){let r=i[L];"L"==e&&"1"==r?i[L]="L":n.test(r)&&(e=r)}for(let L=0;L<f;++L)if(l.test(i[L])){let r;for(r=L+1;r<f&&l.test(i[r]);++r);let t="L"==(L?i[L-1]:o),e="L"==(r<f?i[r]:o),n=t==e?t?"L":"R":o;for(let l=L;l<r;++l)i[l]=n;L=r-1}let s,u=[];for(let L=0;L<f;)if(m.test(i[L])){let r=L;for(++L;L<f&&m.test(i[L]);++L);u.push(new N(0,r,L))}else{let r=L,e=u.length,l="rtl"==t?1:0;for(++L;L<f&&"L"!=i[L];++L);for(let t=r;t<L;)if(b.test(i[t])){r<t&&(u.splice(e,0,new N(1,r,t)),e+=l);let n=t;for(++t;t<L&&b.test(i[t]);++t);u.splice(e,0,new N(2,n,t)),e+=l,r=t}else++t;r<L&&u.splice(e,0,new N(1,r,L))}return"ltr"==t&&(1==u[0].level&&(s=r.match(/^\s+/))&&(u[0].from=s[0].length,u.unshift(new N(0,0,s[0].length))),1==lst(u).level&&(s=r.match(/\s+$/))&&(lst(u).to-=s[0].length,u.push(new N(0,f-s[0].length,f)))),"rtl"==t?u.reverse():u}}();export function getOrder(r,t){let L=r.order;return null==L&&(L=r.order=bidiOrdering(r.text,t)),L}